// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")

}

model User {
  id                        String           @id @default(uuid())
  email                     String           @unique
  password                  String?
  fullName                  String
  googleId                  String?          @unique
  profileImage              String?
  createdAt                 DateTime         @default(now())
  updatedAt                 DateTime         @updatedAt
  
  apiKeys                   ApiKey[]
  wallet                    Wallet?
  transactions              Transaction[]
  
  @@index([email])
  @@index([googleId])
}

model ApiKey {
  id                        String           @id @default(uuid())
  name                      String
  keyHash                   String           @unique
  permissions               String[]
  expiresAt                 DateTime
  isActive                  Boolean          @default(true)
  lastUsedAt                DateTime?
  createdAt                 DateTime         @default(now())
  updatedAt                 DateTime         @updatedAt
  
  userId                    String
  user                      User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
  @@index([keyHash])
}

model Wallet {
  id           String   @id @default(uuid())
  userId       String   @unique
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  walletNumber String   @unique @default(uuid())
  balance      Float    @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([walletNumber])
}


model Transaction {
  id                 String    @id @default(uuid())
  userId             String
  user               User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  reference          String    @unique
  amount             Float
  type               String    // deposit, transfer_in, transfer_out
  status             String    // pending, success, failed
  paystackReference  String?
  gatewayResponse    String?
  metadata           Json?
  completedAt        DateTime?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  @@index([userId])
  @@index([reference])
  @@index([status])
}